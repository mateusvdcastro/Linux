from audioop import add
import socket

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# colocar no linux $ nc 127.0.0.1 4433 
# para conseguir conexão com o servidor que estará escutando

file = open("output.txt", "w")

try:
    server.bind(("0.0.0.0", 4433)) # colocar o servidor para escutar na porta 4433 e pode ser acessado pelo ip 0.0.0.0
    server.listen(5)  # Número de conexões simultâneas
    print("Listening...")

    client_socket, address = server.accept() # server.accept retorna uma tupla
    print("Received from :" + address[0]) # address é uma tupla do ip e da porta

    while True:
        data_received = client_socket.recv(1024).decode()
        file.write(data_received)

        if data_received == "Mensagem Secreta\n":
            client_socket.send(b"Mensagem secreta")
            break


    server.close()
except Exception as error:
    print("Erro", error)
    server.close()

server.send("GET / HTTP / 2".encode())

dados_recebidos = server.recv(100024)

print(dados_recebidos.decode())

server.close()

