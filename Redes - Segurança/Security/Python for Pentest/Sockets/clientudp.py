"""
https://docs.python.org/3/library/socket.html
"""

import socket

# No linux vamos criar um servidor UDP usando netcat
# pode ser usado como um chat para qualquer lugar do mundo
# $ nc -lvup port_number

client = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# socket.AF_INET = conexão IPV4
# socket.SOCK_DGRAM = conexão UDP

try:
    server_udp = "172.24.160.251" # ip do meu kali linux

    # client.connect não deve ser usado pois ele garante o envio e a captação dos dados,
    # mas como queremos usar o protocolo UDP, que somente envia
    client.sendto("Conexao iniciada:\n".encode(), (f"{server_udp}", 1547))  

    while True:
        client.sendto(input("Voce: ").encode() + "\n".encode(), (f"{server_udp}", 1547))

        pacotes_recebidos, addr = client.recvfrom(1024)

        # addr é uma tupla do ip com a porta, portanto, addr[0] é o IP 
        print(f"{addr[0]}: {str(pacotes_recebidos.decode()).strip('b')}")

        # if (str(pacotes_recebidos.decode()) == 'quit'):
        #     client.close()
        #     break

    client.close()

except Exception as erro:
    print("Conexao falhou")
    print(erro)
    client.close()
